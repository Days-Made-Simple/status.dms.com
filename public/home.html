<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Status — PSLE / Countify</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    :root {
      --green-100: #e6ffed;
      --green-600: #059669;
      --yellow-100: #fff7ed;
      --yellow-600: #b45309;
      --red-100: #ffecec;
      --red-600: #dc2626;
      --muted: #6b7280;
      --card-bg: #ffffff;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html, body {height: 100%;margin: 0;}
    body {background: var(--green-100);display: flex;align-items: flex-start;justify-content: center;padding: 48px;transition: background 0.3s ease;}
    .wrap {width: 980px;max-width: 95%;}
    .status-card {background: var(--card-bg);border-radius: 12px;padding: 18px;box-shadow: 0 6px 20px rgba(16,24,40,0.06);border: 1px solid rgba(0,0,0,0.04);}
    h2 {margin-bottom: 10px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="status-card" id="overallCard">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="display:flex;gap:12px;align-items:center;">
          <div id="overallDot" style="font-size:24px;color:var(--green-600);">✓</div>
          <div>
            <h2 id="overallText">All Systems Operational</h2>
            <p id="subtext" style="color:var(--muted);">All monitored services are functioning normally.</p>
          </div>
        </div>
        <div style="text-align:right;color:var(--muted);font-size:13px;">
          <div id="timeAgo">Refreshed 0s ago</div>
          <div>Last checked at <span id="lastChecked">--:--:--</span></div>
        </div>
      </div>
    </div>

    <div style="margin-top:14px;display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="status-card"><span>PSLE Countdown Website</span><span id="PSLEWebsite" style="color:var(--green-600);font-weight:600;float:right">Operational</span></div>
      <div class="status-card"><span>PSLE Countdown Administrator Website</span><span id="PSLEAdmin" style="color:var(--green-600);font-weight:600;float:right">Operational</span></div>
      <div class="status-card"><span>Countify App</span><span id="CountifyApp" style="color:var(--green-600);font-weight:600;float:right">Operational</span></div>
      <div class="status-card"><span>Employee Portal</span><span id="EmployeePortal" style="color:var(--green-600);font-weight:600;float:right">Operational</span></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC6ReZ9JiKAhVwXLUwgzRRsk2Daw3pRli8",
      authDomain: "daysmadesimple-admin.firebaseapp.com",
      projectId: "daysmadesimple-admin",
      storageBucket: "daysmadesimple-admin.firebasestorage.app",
      messagingSenderId: "165327565681",
      appId: "1:165327565681:web:e28364ebb3cb1d9a683cd0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const overallDot = document.getElementById('overallDot');
    const overallText = document.getElementById('overallText');
    const subtext = document.getElementById('subtext');
    const body = document.body;
    const serviceIds = ['PSLEWebsite','PSLEAdmin','CountifyApp','EmployeePortal'];

    const statusColors = {
      operational: {color:'var(--green-600)',text:'Operational',bg:'var(--green-100)'},
      partial: {color:'var(--yellow-600)',text:'Partial Outage',bg:'var(--yellow-100)'},
      disrupted: {color:'var(--red-600)',text:'Disrupted',bg:'var(--red-100)'}
    };

    // Auto-update timestamps
    let lastUpdated = new Date();
    function updateTimestamps() {
      const diff = Math.floor((Date.now() - lastUpdated.getTime())/1000);
      document.getElementById('timeAgo').textContent = `Refreshed ${diff}s ago`;
      document.getElementById('lastChecked').textContent = new Date().toLocaleTimeString();
    }
    setInterval(updateTimestamps, 1000);

    function updateUI(data){
      // Overall
      let worst = 'operational';
      serviceIds.forEach(id=>{
        const status = data[id] || 'operational';
        document.getElementById(id).textContent = statusColors[status].text;
        document.getElementById(id).style.color = statusColors[status].color;
        if(status==='disrupted') worst='disrupted';
        if(status==='partial' && worst!=='disrupted') worst='partial';
      });

      overallDot.textContent = worst==='operational'? '✓' : worst==='partial'? '!' : '✕';
      overallDot.style.color = statusColors[worst].color;
      overallText.textContent = worst==='operational'? 'All Systems Operational' : worst==='partial'? 'Partial Site Outage' : 'Site Disruption';
      subtext.textContent = worst==='operational'? 'All monitored services are functioning normally.' : worst==='partial'? 'Some services are experiencing issues.' : 'Multiple services are down.';
      body.style.background = statusColors[worst].bg;

      lastUpdated = new Date();
    }

    // Listen for Firestore live updates
    db.collection('status').doc('systemStatus')
      .onSnapshot(doc=>{
        if(doc.exists){
          updateUI(doc.data());
        }
      }, err=>{
        console.error('Error fetching status:', err);
      });
  </script>
</body>
</html>
